Taken from pyimagesearch and added more logic
